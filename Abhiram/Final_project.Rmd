---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(plotly)

library(tidyverse)

library(dplyr)

# month <- c('January', 'February', 'March', 'April', 'May', 'June', 'July',
#            'August', 'September', 'October', 'November', 'December')
# high_2000 <- c(32.5, 37.6, 49.9, 53.0, 69.1, 75.4, 76.5, 76.6, 70.7, 60.6, 45.1, 29.3)
# low_2000 <- c(13.8, 22.3, 32.5, 37.2, 49.9, 56.1, 57.7, 58.3, 51.2, 42.8, 31.6, 15.9)
# high_2007 <- c(36.5, 26.6, 43.6, 52.3, 71.5, 81.4, 80.5, 82.2, 76.0, 67.3, 46.1, 35.0)
# low_2007 <- c(23.6, 14.0, 27.0, 36.8, 47.6, 57.7, 58.9, 61.2, 53.3, 48.5, 31.0, 23.6)
# high_2014 <- c(28.8, 28.5, 37.0, 56.8, 69.7, 79.7, 78.5, 77.8, 74.1, 62.6, 45.3, 39.9)
# low_2014 <- c(12.7, 14.3, 18.6, 35.5, 49.9, 58.0, 60.0, 58.6, 51.7, 45.2, 32.2, 29.1)
# 
# data <- data.frame(month, high_2000, low_2000, high_2007, low_2007, high_2014, low_2014)
# 
# #The default order will be alphabetized unless specified as below:
# data$month <- factor(data$month, levels = data[["month"]])
# 
# fig <- plot_ly(data, x = ~month, y = ~high_2014, name = 'High 2014', type = 'scatter', mode = 'lines',
#                line = list(color = 'rgb(205, 12, 24)', width = 4)) 
# fig <- fig %>% add_trace(y = ~low_2014, name = 'Low 2014', line = list(color = 'rgb(22, 96, 167)', width = 4)) 
# fig <- fig %>% add_trace(y = ~high_2007, name = 'High 2007', line = list(color = 'rgb(205, 12, 24)', width = 4, dash = 'dash')) 
# fig <- fig %>% add_trace(y = ~low_2007, name = 'Low 2007', line = list(color = 'rgb(22, 96, 167)', width = 4, dash = 'dash')) 
# fig <- fig %>% add_trace(y = ~high_2000, name = 'High 2000', line = list(color = 'rgb(205, 12, 24)', width = 4, dash = 'dot')) 
# fig <- fig %>% add_trace(y = ~low_2000, name = 'Low 2000', line = list(color = 'rgb(22, 96, 167)', width = 4, dash = 'dot')) 
# fig <- fig %>% layout(title = "Average High and Low Temperatures in New York",
#                       xaxis = list(title = "Months"),
#                       yaxis = list (title = "Temperature (degrees F)"))
# 
# fig







library(readr)
headlines_2021_12_08_15_01_14_CET <- read_csv("headlines-2021-12-08-15-01-14-CET.csv")
View(headlines_2021_12_08_15_01_14_CET)
headlines_2021_12_08_19_20_08_CET <- read_csv("headlines-2021-12-08-19-20-08-CET.csv")
View(headlines_2021_12_08_19_20_08_CET)

headlines_2021_12_08_20_01_21_CET <- read_csv("headlines-2021-12-08-20-01-21-CET.csv")
df_3 = subset(headlines_2021_12_08_20_01_21_CET,select = -c(...1))
headlines_2021_12_09_00_01_58_CET <- read_csv("headlines-2021-12-09-00-01-58-CET.csv")
df_4 = subset(headlines_2021_12_09_00_01_58_CET,select = -c(...1))
headlines_2021_12_09_04_01_37_CET <- read_csv("headlines-2021-12-09-04-01-37-CET.csv")
df_5 = subset(headlines_2021_12_09_04_01_37_CET,select = -c(...1))
headlines_2021_12_09_08_01_21_CET <- read_csv("headlines-2021-12-09-08-01-21-CET.csv")
df_6 = subset(headlines_2021_12_09_08_01_21_CET,select = -c(...1))
headlines_2021_12_09_12_01_27_CET <- read_csv("headlines-2021-12-09-12-01-27-CET.csv")
df_7 = subset(headlines_2021_12_09_12_01_27_CET,select = -c(...1))
headlines_2021_12_08_15_01_14_CET$...1

df_1 = subset(headlines_2021_12_08_15_01_14_CET, select = -c (...1))
df_2 = subset(headlines_2021_12_08_19_20_08_CET,select = -c (...1))

a <- bind_rows(df_1, df_2,df_3,df_4,df_5,df_6,df_7)

text <- a$value

View(text)



# Set the text to lowercase
text <- tolower(text)
# Remove mentions, urls, emojis, numbers, punctuations, etc.
text <- gsub("@\\w+", "", text)
text <- gsub("https?://.+", "", text)
text <- gsub("\\d+\\w*\\d*", "", text)
text <- gsub("#\\w+", "", text)
text <- gsub("[^\x01-\x7F]", "", text)
text <- gsub("[[:punct:]]", " ", text)
# Remove spaces and newlines
text <- gsub("\n", " ", text)
text <- gsub("^\\s+", "", text)
text <- gsub("\\s+$", "", text)
text <- gsub("[ |\t]+", " ", text)
# Put the data to a new column
a["fix_text"] <- text
head(a$fix_text, 10)

View(a)


a$times <- as.Date(a$time, "%d%b%Y:%H:%M:%S")

library(dplyr)

library(tidytext)

Frequent_words <- a %>%
  unnest_tokens(output = word, input = fix_text) %>%
  anti_join(stop_words, by = "word") %>%
  count(word,sort = TRUE)


View(Frequent_words)

# Top_5_total <- Frequent_words[1:5,]
# 
# Top_5_firstday <- Frequent_words_firstday[1:5,]
# 
# Top_5_secondday <- Frequent_words_secondday[1:5,]
# 
# 
# Top_5_firstday["Days"] <- "Day One"
# Top_5_secondday["Days"] <- "Day Two"
# 
# Top_5_fortwodays <- bind_rows(Top_5_firstday,Top_5_secondday)
# 
# christmas <-  Top_5_fortwodays %>% filter(word =="christmas")
# covid <-Top_5_fortwodays %>% filter(word =="covid")
# party <-Top_5_fortwodays %>% filter(word =="party")
# home <-Top_5_fortwodays %>% filter(word =="home")
# 
# 
# Top_5_fortwodays$Days <- factor(Top_5_fortwodays$Days, levels = data[["Days"]])
# 
# fig_words <- plot_ly(data, x = ~christmas$Days, y = ~christmas$n, name = 'christmas', type = 'scatter', mode = 'lines') 
# 
# 
# 
# fig_words <- fig_words %>% add_trace(y = ~covid$n, name = 'covid', line = list(color = 'rgb(22, 96, 167)', width = 4)) 
# fig_words <- fig_words %>% add_trace(y = ~party$n, name = 'party', line = list(color = 'rgb(205, 12, 24)', width = 4, dash = 'dash')) 
# fig_words <- fig_words %>% add_trace(y = ~home$n, name = 'home', line = list(color = 'rgb(22, 96, 167)', width = 4, dash = 'dash')) 
# 
# fig_words <- fig_words %>% layout(title = "Common words for the two days",
#                       xaxis = list(title = "Days"),
#                       yaxis = list (title = "Words"))



UK<- a %>% filter(name %in% c("guardian", "dailymail","mirror","telegraph","independent","times")) %>% mutate(Country ="UK")
US <- a %>% filter(name %in% c("nytimes", "wsj","usatoday","washingtonpost","latimes","tampabay")) %>% mutate(Country ="US")
AUS <- a %>% filter(name %in% c("heraldsun", "dailytelegraph","financialreview","couriermail","westaustralian","advertiser")) %>% mutate(Country ="AUS")
CAN <- a %>% filter(name %in% c("globeandmail", "thestar","nationalpost","torontosun","vancouversun","montrealgazette")) %>% mutate(Country ="CAN")
NZ <- a %>% filter(name %in% c("nzherald", "waikato","businessreview","gisborneherald","dominionpost","thepress")) %>% mutate(Country ="NZ")



new_full <- bind_rows(UK,US,AUS,CAN,NZ)

NEW_FULL <- subset(new_full, select = -c(value,time)) 


NEW<- mutate(NEW_FULL, Days = ifelse(times == "2021-12-08", "Day one", "Day two"))

View(NEW)


ase <- NEW %>%unnest_tokens(word,fix_text)%>%
  anti_join(stop_words, by = "word")

Number <-1

ase["Number"] <- Number


View(ase)










```

##Shiny dashboard 1 : running this code chunk will get you the bar graphs basic version



##Tutorials which i got this stuff from :  1. https://github.com/anastasia-lucas/rladies_shinydashboards (same one on youtube : https://www.youtube.com/watch?v=wSYt4IYIsdI&t=3225s)

## 2. https://github.com/intro-to-data-science-21/labs/tree/main/session-10-shiny/our_app



```{r pressure, echo=FALSE}

library(shiny)
library(shinydashboard)


ui <- dashboardPage(
  dashboardHeader(title = "Most occuring words"),
  dashboardSidebar(),
  dashboardBody(    
    fluidPage(
      fluidRow(
        column(# width should be between 1 and 12
               width=12,
               box(plotOutput("plot1"), 
                   title="Most Common Words Across newspapers",
                   numericInput(inputId = "select_topn", 
                                label = "Select number of words to display", 
                                value = 10, min = 3, max = 20, step=1),
                   # For column based layouts, we can set box width to NULL
                   # This overrides the default value
                   width=NULL)
              )
      )
    )
  )
)

server <- function(input, output) { 
  output$plot1 <- renderPlot({
    Frequent_words %>% top_n(input$select_topn) %>%
    ggplot(aes(x=word, 
               y=n)) +
    geom_col() +
    ylab("count") +
    coord_flip() +
    theme_minimal() +
    scale_fill_gradient(high = "#f6a97a", low="#ca3c97") +
    ggtitle(paste("Top", input$select_topn, "frequently used words")) + 
    geom_blank()
  })


}




shinyApp(ui, server)
```

##Shiny dashboard 2 : running this chunk will get you an advanced bar graph version




```{r}
library(dashboardthemes)

?dashboardthemes::shinyDashboardThemes



ui <- dashboardPage(
  dashboardHeader(title = "Most occuring words"),
  dashboardSidebar(),
  dashboardBody( dashboardthemes::shinyDashboardThemes(
     theme = "onenote"
   ),   
    fluidPage(
      fluidRow(
         column(# width should be between 1 and 12
               width=6,
               box(plotly::plotlyOutput("plot1"), 
                   title="Most Common Words Across Albums",numericInput(inputId = "select_topn", 
                                label = "Select number of words to display", 
                                  value = 15,min = 3, max = 20, step=1),
                   # For column based layouts, we can set box width to NULL
                   # This overrides the default value
                   width=NULL)
              ),
        column(# width should be between 1 and 12
                width=6,
               box(dataTableOutput("table1"),
                   title="Most Common Words Across Albums",
                    # For column based layouts, we can set box width to NULL
                    # This overrides the default value
                    width=NULL)
               )
      )
    )
  )
)
        
server <- function(input, output) { 
  
  v <- reactive({
    validate(
      need(input$select_topn >= 2 & input$select_topn <= 50, "Please select a number between 2 and 50")
    )
})
  
  
  output$plot1 <- plotly::renderPlotly({
    
    v()
   plotly::ggplotly( 
    Frequent_words %>% top_n(input$select_topn) %>%
    ggplot(aes(x=word, 
               y=n)) +
    geom_col() +
    ylab("count") +
    coord_flip() +
    theme_minimal() +
    scale_fill_gradient(high = "#f6a97a", low="#ca3c97") +
    ggtitle(paste("Top", input$select_topn, "frequently used words")) + 
    geom_blank()
   )
  })

 output$table1 <- renderDataTable({
     # Validate for table
     v()
     
     Frequent_words %>% top_n(input$select_topn)
   })
   
  
  
  

}




shinyApp(ui, server)


```



##Shiny dashboard 3 : The main one which we have to figure out.


```{r}


ui <- fluidPage(
  titlePanel("Most occuring words"),
  fluidRow(
    column(3,
           wellPanel(
             h4("Filter"),
             selectInput("Country", "Select the country to focus on",
                         c("US", "UK", "CAN", "AUS", "NZ")
             ),selectInput("name", "Newspaper",
                         c("guardian", "dailymail","mirror","telegraph","independent","times"),
             selectInput("Days" ,"The day in which word occur"),
             textInput("word", "search by word")
           ),
           wellPanel(
             selectInput("xvar", "X-axis variable", axis_vars, selected = "Meter"),
             selectInput("yvar", "Y-axis variable", axis_vars, selected = "Reviews"),
             tags$small(paste0(
               "Note: The Tomato Meter is the proportion of positive reviews",
               " (as judged by the Rotten Tomatoes staff), and the Numeric rating is",
               " a normalized 1-10 score of those reviews which have star ratings",
               " (for example, 3 out of 4 stars)."
             ))
           )
    ),
    column(9,
           plotlyOutput("plot1"),
           wellPanel(
             span("Number of movies selected:",
                  textOutput("n_movies")
             )
           )
    )
  )
)





ui <- dashboardPage(
  dashboardHeader(title = "Word occuring most frequently"),
  dashboardSidebar(),
  dashboardBody(    
    fluidPage(
      fluidRow(
        column(# width should be between 1 and 12
               width=6,
               box(plotOutput("plot1"), 
                   title="Most Common Words Across Albums",
                   numericInput(inputId = "select_topn", 
                                label = "Select number of words to display", 
                                value = 10, min = 3, max = 20, step=1),
                   # For column based layouts, we can set box width to NULL
                   # This overrides the default value
                   width=NULL)
              ),
        column(# width should be between 1 and 12
               width=6,
               box(dataTableOutput("table1"), 
                   title="Most Common Words Across Albums",
                   # For column based layouts, we can set box width to NULL
                   # This overrides the default value
                   width=NULL)
              )
      
      )
    )
  )
)

server <- function(input, output) { 
  output$plot1 <- renderPlot({
    a %>% filter(input$name,input$Country,input$Days) %>% group_by(word) %>% 
      summarise(occurrences=sum(Number)) %>% 
      arrange(desc(occurrences)) %>% 
      top_n(input$select_topn) %>%
      ungroup() %>% 
    ggplot(aes(x=word, 
               y=occurrences)) +
    geom_col() +
    ## Bonus: uncomment to make some aesthetic changes or add your own
    ylab("count") +
    coord_flip() +
    theme_minimal() +
    scale_fill_gradient(high = "#f6a97a", low="#ca3c97") +
    ggtitle(paste("Top", input$select_topn, "frequently used words")) + 
    geom_blank()
  })
  
  output$table1 <- renderDataTable({
    df %>% 
    group_by(word) %>% 
    summarise(occurrences=sum(n)) %>% 
    arrange(desc(occurrences)) %>% 
    top_n(input$select_topn) %>%
    ungroup()
  })
}

shinyApp(ui, server)


```






